{% extends "base.html" %}

{% block title %}Models{% endblock %}

{% block content %}
<div class="models-container">
    <h1>Available AI Models</h1>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search models by name or provider..." class="search-input">
    </div>
    
    <div class="model-list">
        {% for model in models %}
        <div class="model-item" data-name="{{ model.name.lower() }}" data-providers="{{ model.providers|join(' ')|lower }}" data-model-id="{{ model.model_id.lower() }}">
            <div class="model-header">
                <div class="model-title" onclick="toggleModel('{{ model.slug }}')">
                    <div class="model-name-container">
                        <div class="name-with-link">
                            <span class="model-name">{{ model.name }}</span>
                            <a href="https://openrouter.ai/{{ model.model_id }}" target="_blank" class="link-icon" onclick="event.stopPropagation()" title="View on OpenRouter">
                                <svg viewBox="0 0 24 24" width="16" height="16">
                                    <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        </div>
                        <a href="/model/{{ model.slug }}" class="view-details-btn" onclick="event.stopPropagation()">View Details</a>
                    </div>
                    <div class="provider-tags">
                        {% for provider in model.providers %}
                        <span class="provider-tag">{{ provider|title }}</span>
                        {% endfor %}
                    </div>
                    <span class="expand-icon" id="icon-{{ model.slug }}">â–¼</span>
                </div>
            </div>
            
            <div class="model-details" id="{{ model.slug }}" style="display: none;">
                <div class="details-grid">
                    <div class="model-info">
                        <div class="info-row">
                            <span class="info-label">Model ID:</span>
                            <code class="info-value">{{ model.model_id }}</code>
                        </div>
                        {% if model.description %}
                        <div class="info-row">
                            <span class="info-label">Description:</span>
                            <span class="info-value description">{{ model.description }}</span>
                        </div>
                        {% endif %}
                    </div>

                    {% if model.providers %}
                    <div class="provider-details">
                        {% for provider in model.providers %}
                        {% if model.provider_details and provider in model.provider_details %}
                        <div class="provider-section">
                            <div class="provider-header">
                                <h3>{{ provider|title }} Details</h3>
                            </div>
                            <div class="stats-grid">
                                {% if model.provider_details[provider].context %}
                                <div class="stat-item">
                                    <span class="stat-label">Context Length</span>
                                    <span class="stat-value">{{ model.provider_details[provider].context }}</span>
                                </div>
                                {% endif %}
                                {% if model.provider_details[provider].max_output %}
                                <div class="stat-item">
                                    <span class="stat-label">Max Output</span>
                                    <span class="stat-value">{{ model.provider_details[provider].max_output }}</span>
                                </div>
                                {% endif %}
                                {% if model.provider_details[provider].input_price %}
                                <div class="stat-item">
                                    <span class="stat-label">Input Price</span>
                                    <span class="stat-value">{{ model.provider_details[provider].input_price }}</span>
                                </div>
                                {% endif %}
                                {% if model.provider_details[provider].output_price %}
                                <div class="stat-item">
                                    <span class="stat-label">Output Price</span>
                                    <span class="stat-value">{{ model.provider_details[provider].output_price }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if total_pages > 1 %}
    <div class="pagination">
        <div class="pagination-controls">
            {% if current_page > 1 %}
            <a href="{{ url_for('models', page=current_page-1) }}" class="page-btn">Previous</a>
            {% endif %}
            
            <span class="page-info">Page {{ current_page }} of {{ total_pages }}</span>
            
            {% if current_page < total_pages %}
            <a href="{{ url_for('models', page=current_page+1) }}" class="page-btn">Next</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<script>
function toggleModel(modelId) {
    const content = document.getElementById(modelId);
    const icon = document.getElementById(`icon-${modelId}`);
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.classList.add('expanded');
    } else {
        content.style.display = 'none';
        icon.classList.remove('expanded');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const modelItems = document.querySelectorAll('.model-item');
    
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        modelItems.forEach(item => {
            const modelName = item.dataset.name;
            const providers = item.dataset.providers;
            const modelId = item.dataset.modelId;
            
            if (modelName.includes(searchTerm) || providers.includes(searchTerm) || modelId.includes(searchTerm)) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });

        // Hide pagination if searching
        const pagination = document.querySelector('.pagination');
        if (pagination) {
            if (searchTerm) {
                pagination.style.display = 'none';
            } else {
                pagination.style.display = 'flex';
            }
        }
    });
    
});
</script>
{% endblock %}